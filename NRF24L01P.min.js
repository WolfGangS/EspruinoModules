function c(a,b,c,d){this.CSN=b;this.CE=c;this.PAYLOAD=d?d:16;this.cmd="";this.spi=a;this.callbacks=[]}c.C={RX_ADDR_P0:10,RX_ADDR_P1:11,RX_ADDR_P2:12,RX_ADDR_P3:13,RX_ADDR_P4:14,RX_ADDR_P5:15,TX_ADDR:16};c.prototype.init=function(a,b){digitalWrite(this.CE,0);digitalWrite(this.CSN,1);this.setRXAddr(a);this.setTXAddr(b);for(var c=17;22>=c;c++)this.setReg(c,this.PAYLOAD);this.setReg(0,11);this.setReg(4,95);digitalWrite(this.CE,1)};c.prototype.setEnabled=function(a){digitalWrite(this.CE,a)};
c.prototype.setReg=function(a,b){this.spi.send([32|a,b],this.CSN)};c.prototype.setAddr=function(a,b){b=b.clone();b.splice(0,0,32|a);this.spi.send(b,this.CSN)};c.prototype.setRXAddr=function(a,b){void 0===b?b=1:this.setReg(2,this.getReg(2)|1<<b);this.setAddr(10+b,2>b?a:[a[0]])};c.prototype.setTXAddr=function(a){this.setAddr(10,a);this.setAddr(16,a)};c.prototype.getReg=function(a){return this.spi.send([0|a,0],this.CSN)[1]};c.prototype.getAddr=function(a){var b=this.spi.send([0|a,0,0,0,0,0],this.CSN),
b=b.slice(1);return 11<a?(a=this.getAddr(11),a.splice(0,1,b[0]),a):b};c.prototype.getStatus=function(a){return this.getReg(7)};c.prototype.setDataRate=function(a){var b={25E4:32,1E6:0,2E6:8};!a in b&&console.log("Unknown rate");this.setReg(6,this.getReg(6)&-41|b[a])};c.prototype.setTXPower=function(a){this.setReg(6,this.getReg(6)&-7|2*(a&3))};c.prototype.getDataPipe=function(){var a=this.getReg(7)&14;return 14==a?void 0:a>>1};c.prototype.getData=function(){for(var a=[97],b=0;b<this.PAYLOAD;b++)a.push(0);
a=this.spi.send(a,this.CSN);a=a.slice(1);this.setReg(7,64);return a};c.prototype.send=function(a){this.setReg(7,48);digitalWrite(this.CE,0);this.setReg(0,10);this.spi.send(225,this.CSN);a=a.clone();a.splice(0,0,160);this.spi.send(a,this.CSN);digitalWrite(this.CE,1);for(a=1E3;a--&&!(this.getReg(7)&48););0>=a&&print("TX timeout");a=!0;this.getReg(7)&16&&(print("TX not received "+this.getReg(7)),a=!1);digitalWrite(this.CE,0);this.setReg(0,11);digitalWrite(this.CE,1);this.setReg(7,48);return a};c.prototype.slaveHandler=
function(){for(;void 0!==this.getDataPipe();){var a=this.getData(),b;for(b in a){var c=a[b];if(0===c&&""!==this.cmd){var d=this.cmd;this.cmd="";var f=this;setTimeout(function(){print("...>"+d);var a=""+eval(d);print("...="+a);setTimeout(function(){f.sendString(a)},500)},1)}else 0!==c&&(this.cmd+=String.fromCharCode(c))}}};c.prototype.masterHandler=function(){for(;void 0!==this.getDataPipe();){var a=this.getData(),b;for(b in a){var c=a[b];if(0===c&&""!==this.cmd){c=this.cmd;this.cmd="";var d=this.callbacks.splice(0,
1)[0];void 0!==d&&d(c)}else 0!==c&&(this.cmd+=String.fromCharCode(c))}}};c.prototype.sendString=function(a){for(var b=0;b<=a.length;b+=this.PAYLOAD){for(var c=[],d=0;d<this.PAYLOAD;d++)c[d]=a.charCodeAt(b+d);if(!this.send(c))return!1}return!0};c.prototype.sendCommand=function(a,b){this.callbacks.push(b);return this.sendString(a)};exports.connect=function(a,b,e,d){return new c(a,b,e,d)}