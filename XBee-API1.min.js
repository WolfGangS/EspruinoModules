exports.connect=function(m){return new t(m)};var t=function(m){var p=this,h="S",k=0,q=-1,n=void 0,r=0,l=0;this.ser=m;this.seq=1;this.timeout=10;this.callbacks=[];this.rxcb=void 0;m.on("data",function(a){for(var b in a)switch(a=a.charCodeAt(b),h){case "S":126==a&&(l=0,n=void 0,r=0,h="LH");break;case "LH":k=255*a;h="LL";break;case "LL":k+=a;h="FT";255>k&&(n=new Uint8Array(k-1));break;case "FT":q=a;h="D";k--;l+=a;break;case "D":n[r++]=a;l+=a;0===--k&&(h="CS");break;case "CS":a==255-(l&255)?
p.prepCB(q,n):console.log("xBee: Checksum Fail"),h="S"}});this.prepCB=function(a,b){var c={},d,e,f=0;if(136==a)for(f=b[0],c.cmd=String.fromCharCode(b[1],b[2]),c.status=b[3],c.data=[],d=4;d<b.length;d++)c.data.push(b[d]);else if(139==a)f=b[0],c.destination=[b[1],b[2]],c.retrycount=b[3],c.delivery_status=b[4],c.discovery_status=b[5];else if(144==a){c.addr64=new Uint8Array(8);for(d=0;8>d;d++)c.addr64[d]=b[d];c.addr16=new Uint8Array(2);c.addr16[0]=b[8];c.addr16[1]=b[9];c.option=b[10];c.data=new Uint8Array(b.length-
11);d=11;for(e=0;d<b.length;d++)c.data[e++]=b[d];void 0!==this.rxcb&&this.rxcb(c)}else console.log("xBee: Unknown Frametype: "+a.toString(16));0<f&&(clearTimeout(this.callbacks[f][1]),this.callbacks[f][0](!0,c),delete this.callbacks[f])};this.regCB=function(a,b){var c=setTimeout(function(){p.cancelCB(a)},1E3*this.timeout);this.callbacks[a]=[b,c]};this.cancelCB=function(a){this.callbacks[a][0](!1,"");delete this.callbacks[a]};this.AT=function(a,b,c){a=this.atFrame(a,b);this.ser.write(a);this.regCB(a[4],
c)};this.TX=function(a,b,c,d,e){a=this.transmitFrame(a,b,c,d);this.ser.write(a);this.regCB(a[4],e)};this.RX=function(a){this.rxcb=a};this.transmitFrame=function(a,b,c,d){var e,f,g=new Uint8Array(17+d.length+1);g.set([126,0,0,16,this.seq]);f=5;for(e=0;e<a.length;e++)g[f++]=a[e];for(e=0;e<b.length;e++)g[f++]=b[e];g[f++]=0;g[f++]=c;for(e=0;e<d.length;e++)g[f++]=d[e];this.calcLandC(g);this.seq++;255<this.seq&&(this.seq=1);return g};this.atFrame=function(a,b){var c,d,e=new Uint8Array(7+b.length+1);e.set([126,
0,0,8,this.seq,a.charCodeAt(0),a.charCodeAt(1)]);c=0;for(d=7;c<b.length;c++)e[d++]=b[c];this.calcLandC(e);this.seq++;255<this.seq&&(this.seq=1);return e};this.calcLandC=function(a){var b=0,b=a.length-4,c=0;a[2]=b&255;a[1]=b>>8;for(b=3;b<a.length;b++)c+=a[b];c=255-(c&255);a[a.length-1]=c}}