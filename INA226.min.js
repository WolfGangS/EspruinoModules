function c(a,b){this.i2c=a;b=b||{};this.addr=b.addr||64;this.maxCurrent=b.maxCurrent||10;this.currentLSB=this.maxCurrent/32768;this.shunt=b.shunt||.1;if(21577!=this.rd(254))throw Error("Invalid manufacturer ID");var d=16679;b.average=b.average||256;if(b.average){var c=[1,4,16,64,128,256,512,1024].indexOf(b.average);if(0>c)throw Error("average must be 1,4,16,64,128,256,512 or 1024");d|=c<<9}this.wr(0,d);d=Math.round(.00512/(this.currentLSB*this.shunt));if(0>d||32767<d)throw Error("maxCurrent/shunt mean calibration is out of range");
this.wr(5,d);this.wr(6,1024)}c.prototype.rd=function(a){this.i2c.writeTo(this.addr,a);a=this.i2c.readFrom(this.addr,2);return a[1]|a[0]<<8};c.prototype.wr=function(a,b){this.i2c.writeTo(this.addr,[a,b>>8,b&255])};c.prototype.rds=function(a){a=this.rd(a);return a&32768?a-65536:a};c.prototype.read=function(){var a=this.rd(6);return{vshunt:2.5E-5*this.rds(1),vbus:.00125*this.rd(2),power:25*this.rd(3)*this.currentLSB,current:this.rds(4)*this.currentLSB,overflow:0!=(a&4)}};exports=c