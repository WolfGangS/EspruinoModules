function b(a,c){var d=this;this.serial=a;this.at=require("AT").connect(a);this.at.registerLine('+CMTI: "SM",',function(a){d.emit("message",a.substr(12));return""})}function g(a){if(0!=(a.length&3))return a;for(var c="",d=0;d<a.length;d+=4){var e=parseInt(a.substr(d,4),16);if(isNaN(e))return a;c+=String.fromCharCode(e)}return c}b.prototype.init=function(a){var c=this.at;this.at.cmd("ATE0\r\n",3E3,function e(b){if("ATE0"==b)return e;"OK"!=b&&a("ATE0 ERROR "+b);c.cmd("AT+CMGF=1\r\n",1E3,
function(c){a&&a("OK"==c?null:"CMGF ERROR "+c)})})};b.prototype.send=function(a,c,d){var e=this.at;e.register(">",function(){e.unregister(">");e.write(c+"\u001a\r");return""});e.cmd('AT+CMGS="'+a+'"\r\n',1E4,function f(a){e.unregister(">");if(a&&"+CMGS"==a.substr(0,5))return f;d&&d("OK"==a?null:"CMGS ERROR "+a)})};b.prototype.list=function(a,c){var d=[],e;this.at.cmd('AT+CMGL="'+a+'"\r\n',1E4,function f(a){if(void 0!==e&&void 0!==a)return e.text=g(a),e=void 0,f;if(a&&"+CMGL: "==a.substr(0,7)){try{var b=
JSON.parse("["+a.substr(7)+"]");e={index:b[0],isRead:"REC READ"==b[1],oaddr:b[2],oname:b[3],time:b[4],text:""};d.push(e)}catch(l){}return f}c&&c("OK"==a?null:"CMGL ERROR "+a,d)})};b.prototype.get=function(a,c){var d;this.at.cmd("AT+CMGR="+a+"\r\n",1E4,function h(a){if("OK"==a)return c(null,d);if(void 0!==d&&void 0!==a&&"OK"!=a)return d.text=g(a),h;if(a&&"+CMGR: "==a.substr(0,7)){try{var b=JSON.parse("["+a.substr(7)+"]");d={isRead:"REC READ"==b[0],oaddr:b[1],oname:b[2],time:b[3],text:""}}catch(k){}return h}c&&
c("OK"==a?null:"CMGR ERROR "+a,list)})};b.prototype["delete"]=function(a,b){"ALL"==a&&(a="1,4");this.at.cmd("AT+CMGD="+a+"\r\n",1E3,function(a){b&&b("OK"==a?null:"CMGD ERROR "+a)})};exports=b